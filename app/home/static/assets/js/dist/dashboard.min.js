const moderatePatientColor="#10739E",seriusPatientColor="#CF8913",criticalPatientColor="#9D443D";let skeletonClasses=["skeleton","skeleton-text","skeleton-chart","skeleton-table","skeleton-body","skeleton-w-10","skeleton-w-20","skeleton-w-30","skeleton-w-40","skeleton-w-50","skeleton-w-60","skeleton-w-70","skeleton-w-90","skeleton-w-90","skeleton-w-100"];date.locale("es");let patientTable;var totalPatientChartInstance;function capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}function setDateFormat(t,e){const a=date.format(new Date(t),e);return capitalize(a.replace(".",""))}function setPatientCard(t,e,a){const n=document.getElementById(a+"-label");n.innerHTML=e.label,removeSkeletonClasses(n);var o=document.getElementById(a+"-dropdown-container");const r=document.getElementById(a+"-dropdown-label"),s=document.getElementById(a+"-dropdown-filters");r.innerHTML=t,s.classList.remove("d-none"),removeSkeletonClasses(o);t=document.getElementById(a+"-status-container"),setCoutUp(document.getElementById(a+"-status"),e.total),removeSkeletonClasses(t),o=document.getElementById(a+"-percentage-container");setPatientCardPercentage(a,e.percentage,e.percentage_label),removeSkeletonClasses(o)}function setPatientCardPercentage(t,e,a){const n=document.getElementById(t+"-percentage");0<(e=e.toFixed(0))?(n.innerHTML=`+${e}%`,n.classList.remove("text-success"),n.classList.add("text-danger")):(n.innerHTML=e+"%",n.classList.remove("text-danger"),n.classList.add("text-success")),n.innerHTML+=`<span class="font-weight-normal opacity-8 text-dark" id="moderate-percentage-label"> ${a}</span>`}function createWeeklyPatientsChart(t,e,a,n){var o=document.getElementById("weekly-chart-container"),r=document.getElementById("weekly-patient-chart").getContext("2d");new Chart(r,{type:"bar",data:{labels:getChartLabels(t.labels),datasets:[{label:e.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:moderatePatientColor,data:e.data,maxBarThickness:20},{label:a.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:seriusPatientColor,data:a.data,maxBarThickness:20},{label:n.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:criticalPatientColor,data:n.data,maxBarThickness:20}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle"}},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1},stacked:!0},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{beginAtZero:!0,font:{size:12,family:"Open Sans",style:"normal"},color:"#9ca2b7"},stacked:!0}}}}),removeSkeletonClasses(o)}function createTotalPatientsDoughnutChart(t){var e=t.data.moderate_patients,a=t.data.serius_patients,n=t.data.critical_patients,o=document.getElementById("total-doughnut-chart-container");const r=document.getElementById("total-patient-doughnut-chart").getContext("2d"),s=r.createLinearGradient(0,230,0,50);var l=document.getElementById("total-doughnut-chart-status");const i=document.getElementById("total-doughnut-chart-label");s.addColorStop(1,"rgba(16, 115, 158,0.2)"),s.addColorStop(.2,"rgba(72,72,176,0.0)"),s.addColorStop(0,"rgba(16, 115, 158,0)"),new Chart(r,{type:"doughnut",data:{labels:[e.label,a.label,n.label],datasets:[{weight:10,cutout:90,tension:.9,pointRadius:2,borderWidth:1,borderRadius:5,backgroundColor:[moderatePatientColor,seriusPatientColor,criticalPatientColor],data:[e.total,a.total,n.total],fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle"}},interaction:{intersect:!1,mode:"point"},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}}}}}),setCoutUp(l,t.total),i.classList.remove("d-none"),removeSkeletonClasses(o),createTotalTable(e,a,n)}function createTotalTable(t,e,a){var n=document.getElementById("total-table-container");const o=document.getElementById("total-table");o.innerHTML+=`
        <tbody>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge moderate-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${t.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-moderate-status"> ${t.total} </span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge serius-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${e.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-serius-status"> ${e.total} </span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge critical-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${a.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-critical-status"> ${a.total} </span>
                </td>
            </tr>
        </tbody>
    `,removeSkeletonClasses(n)}function createTotalPatientsLineChart(t){var e=t.data.moderate_patients,a=t.data.serius_patients,n=t.data.critical_patients,o=document.getElementById("total-line-chart-status");const r=document.getElementById("total-line-chart-label");var s=document.getElementById("total-line-chart-label-container");const l=document.getElementById("total-line-badges"),i=document.getElementById("total-line-chart-percentage");setCoutUp(o,t.total),r.classList.remove("d-none"),i.innerHTML=setTotalPatientPercentage(t.total_percentage),setLegendTotalPatientLineChart("moderate",e.label),setLegendTotalPatientLineChart("serius",a.label),setLegendTotalPatientLineChart("critical",n.label),l.classList.add("mb-1"),constructTotalPatientLineChart(t.labels,e,a,n),removeSkeletonClasses(o),removeSkeletonClasses(s),removeSkeletonClasses(i)}function setTotalPatientPercentage(t){return 0<=(t=t.toFixed(0))?`
            <i class="ni ni-bold-up text-sm text-danger me-1"></i>
            <span class="text-sm text-end text-danger font-weight-bolder mt-auto mb-0">+${t}%</span>
            <span class="text-secondary text-sm ms-2">en <strong>${(new Date).getFullYear()}</strong></span>
        `:`
            <i class="ni ni-bold-down text-sm text-success me-1"></i>
            <span class="text-sm text-end text-success font-weight-bolder mt-auto mb-0">${t}%</span>
            <span class="text-secondary text-sm ms-2">en <strong>${(new Date).getFullYear()}</strong></span>
        `}function setLegendTotalPatientLineChart(t,e){const a=document.getElementById(`total-line-${t}-badge`);a.innerHTML=`
        <i class="${t}-bg"></i>
        <span class="text-dark text-xs">${e}</span>
    `,removeSkeletonClasses(a)}function getChartLabels(t){let=labels=[];const e=(new Date).getFullYear().toString();return t.map(t=>{t.includes(e)&&labels.push(t.replace(" "+e,""))}),labels}function constructTotalPatientLineChart(t,e,a,n){totalPatientChartInstance&&totalPatientChartInstance.destroy();var o=document.getElementById("total-line-chart-container");const r=document.getElementById("total-line-chart").getContext("2d"),s=r.createLinearGradient(0,230,0,50),l=r.createLinearGradient(0,230,0,50),i=r.createLinearGradient(0,230,0,50);s.addColorStop(1,"rgba(23, 194, 232, 0.2)"),s.addColorStop(.2,"rgba(72,72,176,0.0)"),s.addColorStop(0,"rgba(23, 194, 232,0)"),l.addColorStop(1,"rgba(58, 65, 111,0.2)"),l.addColorStop(.2,"rgba(72,72,176,0.0)"),l.addColorStop(0,"rgba(58, 65, 111,0)"),i.addColorStop(1,"rgba(203, 12, 159,0.2)"),i.addColorStop(.2,"rgba(72,72,176,0.0)"),i.addColorStop(0,"rgba(203, 12, 159,0)"),totalPatientChartInstance=new Chart(r,{type:"line",data:{labels:getChartLabels(t),datasets:[{label:e.label,tension:.4,pointRadius:2,pointBackgroundColor:moderatePatientColor,borderColor:moderatePatientColor,backgroundColor:s,borderWidth:3,fill:!0,data:e.data,maxBarThickness:6},{label:a.label,tension:.4,pointRadius:2,pointBackgroundColor:seriusPatientColor,borderColor:seriusPatientColor,backgroundColor:l,borderWidth:3,fill:!0,data:a.data,maxBarThickness:6},{label:n.label,tension:.4,pointRadius:2,pointBackgroundColor:criticalPatientColor,borderColor:criticalPatientColor,backgroundColor:i,borderWidth:3,fill:!0,data:n.data,maxBarThickness:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle",position:"nearest"}},interaction:{mode:"index"},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{beginAtZero:!0,font:{size:12,family:"Open Sans",style:"normal"},color:"#9ca2b7"}}}}}),removeSkeletonClasses(o)}function clearPatientDataTable(t){patientTable.clear(),patientTable.destroy(),t.removeChild(t.getElementsByTagName("tbody")[0])}function createSummaryTable(t){var e=document.getElementById("datatable-patients-container");const a=document.getElementById("datatable-patients");patientTable&&clearPatientDataTable(a);t=setTbodySummaryTable(t.patients,"DD MMM YYYY");a.innerHTML+=`
        <tbody>
            ${t}
        </tbody>
    `,a.classList.remove("d-none"),removeSkeletonClasses(e),setDatatablePlugin()}function setTbodySummaryTable(t,e){let a="";return t.forEach(t=>{a+=`
           <tr>
            <td class="text-sm text-dark fw-bolder">${t.identification}</td>
            <td class="text-sm text-dark fw-bolder">${t.name}</td>
            <td class="text-sm text-dark fw-bolder">${setDateFormat(t.created_at,e)}</td>
            <td class="text-sm text-dark fw-bolder">${setCaseSeverityPatient(t.covid19_severity)}</td>
            <td class="text-sm text-dark fw-bolder">${t.sato2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.pao2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.fio2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.pf_ratio} mmHg</td>
            <td>${setTdSyntomatology(t.respiratory_failure)}</td>
            <td>${setTdSyntomatology(t.ards)}</td>
            <td>${setTdSyntomatology(t.sepsis_shock)}</td>
            <td>${setTdSyntomatology(t.fever)}</td>
            <td>${setTdSyntomatology(t.cough)}</td>
            <td>${setTdSyntomatology(t.sore_throat)}</td>
            <td>${setTdSyntomatology(t.headache)}</td>
            <td>${setTdSyntomatology(t.fatigue)}</td>
            <td>${setTdSyntomatology(t.dyspnea)}</td>
            <td>${setTdSyntomatology(t.nausea)}</td>
            <td>${setTdSyntomatology(t.vomit)}</td>
            <td>${setTdSyntomatology(t.diarrhea)}</td>
           </tr>
        `}),a}function setCaseSeverityPatient(t){var e=t.toLowerCase();return"moderado"===e?`<span class="badge moderate-bg badge-sm">${t}</span>`:"grave"===e?`<span class="badge serius-bg badge-sm">${t}</span>`:`<span class="badge critical-bg badge-sm">${t}</span>`}function setTdSyntomatology(t){return t?`
            <div class="d-flex align-items-center">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="td-icon text-danger" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path fill="none" d="M0 0h24v24H0z"></path>
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                </svg>
                <p class="text-sm text-dark fw-bolder mb-0">SI</p>
            </div>
        `:`
        <div class="d-flex align-items-center">
            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="td-icon text-success" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" d="M0 0h24v24H0z"></path>
                <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path>
            </svg>
            <p class="text-sm text-dark fw-bolder mb-0">NO</p>
        </div>
    `}function setDatatablePlugin(){patientTable=new simpleDatatables.DataTable("#datatable-patients")}function setCoutUp(t,e){if(t.setAttribute("countTo",e),t){const a=new CountUp(t,t.getAttribute("countTo"));a.error||a.start()}}function initializeTooltips(){const t=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));t.map(function(t){return new bootstrap.Tooltip(t,{})})}function removeSkeletonClasses(t){t.classList.remove(...skeletonClasses)}function aosInit(){AOS.init({duration:1e3,easing:"ease-in-out",once:!1,mirror:!1})}function errorAlert(){Swal.fire({icon:"error",title:"Error al procesar la solicitud",text:"Intente nuevamente por favor!",confirmButtonText:"Aceptar",timer:3e3,timerProgressBar:!0})}function setCardDate(t,e){return e=setDateFormat((new Date).toDateString(),"MM/DD/YYYY")===e?(t=setDateFormat(t,"DD de MMMM"),"Hoy"):(t=setDateFormat(t,"DD de MMM"),setDateFormat(e,"DD de MMM")),t+" - "+e}function getInitialData(){$.ajax({url:"/initial-dashboard-data",type:"GET",success:t=>{var e=t.weekly_ranking,a=t.annual_ranking,n=t.total_ranking,t=t.summary,o=setCardDate(e.start_date,e.end_date),r=e.data.moderate_patients,s=e.data.serius_patients,l=e.data.critical_patients;setPatientCard(o,r,"moderate"),setPatientCard(o,s,"serius"),setPatientCard(o,l,"critical"),createWeeklyPatientsChart(e,r,s,l),createTotalPatientsDoughnutChart(n),createTotalPatientsLineChart(a),createSummaryTable(t),initializeTooltips()},error:()=>{window.location.href="/internal-error"}})}function queryPatientCard(e){$.ajax({url:"/filter-patient-card",type:"GET",data:e,success:t=>{setPatientCard(setCardDate(t.start_date,t.end_date),t.data.patients,e.covid19Severity)},error:()=>{errorAlert()}})}const dropDownOptions=document.querySelectorAll("#moderate-dropdown-options li a, #serius-dropdown-options li a, #critical-dropdown-options li a");function queryTotalPatientLineChart(t){$.ajax({url:"/filter-total-line-chart",type:"GET",data:t,success:t=>{createTotalPatientsLineChart(t.ranking)},error:()=>{errorAlert()}})}function resetTotalPatientLineChart(){dates=[],queryTotalPatientLineChart({startDate:setDateFormat(new Date,"DD-MMM-YYYY")})}function clearDatePicker(){document.querySelector(".datepicker")._flatpickr.clear(),resetTotalPatientLineChart()}function querySummaryTable(t){$.ajax({url:"/filter-summary-table",type:"GET",data:t,success:t=>{createSummaryTable(t.summary)},error:()=>{errorAlert()}})}dropDownOptions.forEach(t=>{t.addEventListener("click",()=>{queryPatientCard({covid19Severity:t.getAttribute("data-severity"),dateRange:t.getAttribute("date-range")})})}),document.querySelector(".datepicker")&&flatpickr(".datepicker",{mode:"range",locale:"es",dateFormat:"d M Y",maxDate:new Date,onChange:t=>{var e;2===t.length&&((e=setDateFormat(t[0],"MM-DD-YYYY"))===(t=setDateFormat(t[1],"MM-DD-YYYY"))?clearDatePicker():queryTotalPatientLineChart({startDate:e,endDate:t}))},onClose:t=>{t.length<2&&resetTotalPatientLineChart()}}),document.getElementById("clear-date").addEventListener("click",()=>{clearDatePicker()});const summaryDropDownOptions=document.querySelectorAll("#dropdown-table-options li a");summaryDropDownOptions.forEach(t=>{t.addEventListener("click",()=>{querySummaryTable({covid19Severity:t.getAttribute("data-severity")})})}),window.addEventListener("load",()=>{aosInit(),getInitialData()});
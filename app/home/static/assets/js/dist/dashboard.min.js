window.addEventListener("load",()=>{aosInit(),getInitialData()});const moderatePatientColor="#10739E",seriusPatientColor="#CF8913",criticalPatientColor="#9D443D";let skeletonClasses=["skeleton","skeleton-text","skeleton-chart","skeleton-table","skeleton-body","skeleton-w-10","skeleton-w-20","skeleton-w-30","skeleton-w-40","skeleton-w-50","skeleton-w-60","skeleton-w-70","skeleton-w-90","skeleton-w-90","skeleton-w-100"];function getInitialData(){$.ajax({url:"/initial-dashboard-data",type:"GET",success:t=>{var e=t.weekly_ranking,a=t.annual_ranking,o=t.total_ranking,t=t.summary,s=e.date,n=e.values.moderate_patients,l=e.values.serius_patients,r=e.values.critical_patients;setPatientCard(s,n,"moderate"),setPatientCard(s,l,"serius"),setPatientCard(s,r,"critical"),createWeeklyPatientsChart(e,n,l,r),createTotalPatientsDoughnutChart(o),createTotalPatientsLineChart(a),createSummaryTable(t),initializeTooltips()}})}function setPatientCard(t,e,a){var o=document.getElementById(a+"-label"),o=(o.innerHTML=e.label,removeSkeletonClasses(o),document.getElementById(a+"-dropdown-container")),s=document.getElementById(a+"-dropdown-label"),n=document.getElementById(a+"-dropdown-filters"),s=(s.innerHTML=t,n.classList.remove("d-none"),removeSkeletonClasses(o),document.getElementById(a+"-status-container")),t=(setCoutUp(document.getElementById(a+"-status"),e.total),removeSkeletonClasses(s),document.getElementById(a+"-percentage-container"));setPatientCardPercentage(a,e.percentage,e.percentage_label),removeSkeletonClasses(t)}function setPatientCardPercentage(t,e,a){t=document.getElementById(t+"-percentage");0<=e?(t.innerHTML=`+${e}%`,t.classList.add("text-danger")):(t.innerHTML=e+"%",t.classList.add("text-success")),t.innerHTML+=`<span class="font-weight-normal opacity-8 text-dark" id="moderate-percentage-label"> ${a}</span>`}function createWeeklyPatientsChart(t,e,a,o){var s=document.getElementById("weekly-chart-container"),n=document.getElementById("weekly-patient-chart").getContext("2d");new Chart(n,{type:"bar",data:{labels:t.labels,datasets:[{label:e.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:moderatePatientColor,data:e.data,maxBarThickness:20},{label:a.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:seriusPatientColor,data:a.data,maxBarThickness:20},{label:o.label,tension:1,borderWidth:0,borderRadius:5,backgroundColor:criticalPatientColor,data:o.data,maxBarThickness:20}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle"}},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1},stacked:!0},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{beginAtZero:!0,font:{size:12,family:"Open Sans",style:"normal"},color:"#9ca2b7"},stacked:!0}}}}),removeSkeletonClasses(s)}function createTotalPatientsDoughnutChart(t){var e=t.values.moderate_patients,a=t.values.serius_patients,o=t.values.critical_patients,s=document.getElementById("total-doughnut-chart-container"),n=document.getElementById("total-patient-doughnut-chart").getContext("2d"),l=n.createLinearGradient(0,230,0,50),r=document.getElementById("total-doughnut-chart-status"),d=document.getElementById("total-doughnut-chart-label");l.addColorStop(1,"rgba(16, 115, 158,0.2)"),l.addColorStop(.2,"rgba(72,72,176,0.0)"),l.addColorStop(0,"rgba(16, 115, 158,0)"),new Chart(n,{type:"doughnut",data:{labels:[e.label,a.label,o.label],datasets:[{weight:10,cutout:90,tension:.9,pointRadius:2,borderWidth:1,borderRadius:5,backgroundColor:[moderatePatientColor,seriusPatientColor,criticalPatientColor],data:[e.total,a.total,o.total],fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle"}},interaction:{intersect:!1,mode:"point"},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}}}}}),setCoutUp(r,t.total),d.classList.remove("d-none"),removeSkeletonClasses(s),createTotalTable(e,a,o)}function createTotalTable(t,e,a){var o=document.getElementById("total-table-container");document.getElementById("total-table").innerHTML+=`
        <tbody>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge moderate-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${t.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-moderate-status"> ${t.total} </span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge serius-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${e.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-serius-status"> ${e.total} </span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="d-flex px-2 py-0">
                        <span class="badge critical-bg me-3"> </span>
                        <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">${a.label.split(" ")[1]}</h6>
                        </div>
                    </div>
                </td>
                <td class="align-middle text-center text-sm">
                    <span class="text-body text-xs font-weight-bold" id="donut-critical-status"> ${a.total} </span>
                </td>
            </tr>                                   
        </tbody>
    `,removeSkeletonClasses(o)}function createTotalPatientsLineChart(t){var e=t.values.moderate_patients,a=t.values.serius_patients,o=t.values.critical_patients,s=document.getElementById("total-line-chart-status"),n=document.getElementById("total-line-chart-label"),l=document.getElementById("total-line-chart-percentage");setCoutUp(s,t.total),n.classList.remove("d-none"),l.innerHTML+=setTotalPatientPercentage(l,t.total_percentage),setLegendTotalPatientLineChart("moderate",e.label),setLegendTotalPatientLineChart("serius",a.label),setLegendTotalPatientLineChart("critical",o.label),constructTotalPatientLineChart(t.labels,e,a,o),removeSkeletonClasses(s),removeSkeletonClasses(n),removeSkeletonClasses(l)}function setTotalPatientPercentage(t,e){return 0<=e?`
            <i class="ni ni-bold-up text-sm text-danger"></i>
            <span class="text-sm text-end text-danger font-weight-bolder mt-auto mb-0">+${e}%</span>
        `:`
            <i class="ni ni-bold-down text-sm text-success"></i>
            <span class="text-sm text-end text-success font-weight-bolder mt-auto mb-0">${e}%</span>
        `}function setLegendTotalPatientLineChart(t,e){var a=document.getElementById(`total-line-${t}-badge`);a.innerHTML=`
        <i class="${t}-bg"></i>
        <span class="text-dark text-xs">${e}</span>
    `,removeSkeletonClasses(a)}function constructTotalPatientLineChart(t,e,a,o){var s=document.getElementById("total-line-chart-container"),n=document.getElementById("total-line-chart").getContext("2d"),l=n.createLinearGradient(0,230,0,50),r=n.createLinearGradient(0,230,0,50),d=n.createLinearGradient(0,230,0,50);l.addColorStop(1,"rgba(23, 194, 232, 0.2)"),l.addColorStop(.2,"rgba(72,72,176,0.0)"),l.addColorStop(0,"rgba(23, 194, 232,0)"),r.addColorStop(1,"rgba(58, 65, 111,0.2)"),r.addColorStop(.2,"rgba(72,72,176,0.0)"),r.addColorStop(0,"rgba(58, 65, 111,0)"),d.addColorStop(1,"rgba(203, 12, 159,0.2)"),d.addColorStop(.2,"rgba(72,72,176,0.0)"),d.addColorStop(0,"rgba(203, 12, 159,0)"),new Chart(n,{type:"line",data:{labels:t,datasets:[{label:e.label,tension:.4,borderWidth:0,pointRadius:2,pointBackgroundColor:moderatePatientColor,borderColor:moderatePatientColor,borderWidth:3,backgroundColor:l,fill:!0,data:e.data,maxBarThickness:6},{label:a.label,tension:.4,borderWidth:0,pointRadius:2,pointBackgroundColor:seriusPatientColor,borderColor:seriusPatientColor,borderWidth:3,backgroundColor:r,fill:!0,data:a.data,maxBarThickness:6},{label:o.label,tension:.4,borderWidth:0,pointRadius:2,pointBackgroundColor:criticalPatientColor,borderColor:criticalPatientColor,borderWidth:3,backgroundColor:d,fill:!0,data:o.data,maxBarThickness:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,pointStyle:"circle",position:"nearest"}},interaction:{mode:"index"},scales:{y:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1},ticks:{beginAtZero:!0,font:{size:12,family:"Open Sans",style:"normal"},color:"#9ca2b7"}}}}}),removeSkeletonClasses(s)}function createSummaryTable(t){var e=document.getElementById("datatable-patients-container"),a=document.getElementById("datatable-patients"),t=setTbodySummaryTable(t.patients);a.innerHTML+=`
        <tbody>
            ${t}
        </tbody>
    `,a.classList.remove("d-none"),removeSkeletonClasses(e),setDatatablePlugin()}function setTbodySummaryTable(t){var e="";return t.forEach(t=>{e+=`
           <tr>
            <td class="text-sm text-dark fw-bolder">${t.identification}</td>
            <td class="text-sm text-dark fw-bolder">${t.name}</td>
            <td class="text-sm text-dark fw-bolder">${t.date}</td>
            <td class="text-sm text-dark fw-bolder">${setCaseSeverityPatient(t.case_severity)}</td>
            <td class="text-sm text-dark fw-bolder">${t.sato2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.pao2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.fio2}%</td>
            <td class="text-sm text-dark fw-bolder">${t.pf_ratio} mmHg</td>
            <td>${setTdSyntomatology(t.respiratory_failure)}</td>
            <td>${setTdSyntomatology(t.ards)}</td>
            <td>${setTdSyntomatology(t.sepsis_shock)}</td>
            <td>${setTdSyntomatology(t.fever)}</td>
            <td>${setTdSyntomatology(t.cough)}</td>
            <td>${setTdSyntomatology(t.sore_throat)}</td>
            <td>${setTdSyntomatology(t.headache)}</td>
            <td>${setTdSyntomatology(t.fatigue)}</td>
            <td>${setTdSyntomatology(t.dyspnea)}</td>
            <td>${setTdSyntomatology(t.nausea)}</td>
            <td>${setTdSyntomatology(t.vomit)}</td>
            <td>${setTdSyntomatology(t.diarrhea)}</td>
           </tr> 
        `}),e}function setCaseSeverityPatient(t){var e=t.toLowerCase();return"moderado"===e?`<span class="badge moderate-bg badge-sm">${t}</span>`:"grave"===e?`<span class="badge serius-bg badge-sm">${t}</span>`:`<span class="badge critical-bg badge-sm">${t}</span>`}function setTdSyntomatology(t){return t?`
            <div class="d-flex align-items-center">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="td-icon text-danger" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path fill="none" d="M0 0h24v24H0z"></path>
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                </svg>
                <p class="text-sm text-dark fw-bolder mb-0">SI</p>
            </div>
        `:`
        <div class="d-flex align-items-center">
            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="td-icon text-success" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" d="M0 0h24v24H0z"></path>
                <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path>
            </svg>
            <p class="text-sm text-dark fw-bolder mb-0">NO</p>
        </div>
    `}function setDatatablePlugin(){new simpleDatatables.DataTable("#datatable-patients",{searchable:!0,fixedHeight:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Todos"]]})}function setCoutUp(t,e){if(t.setAttribute("countTo",e),t){const a=new CountUp(t,t.getAttribute("countTo"));a.error?console.error(a.error):a.start()}}function initializeTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t,{})})}function removeSkeletonClasses(t){t.classList.remove(...skeletonClasses)}function aosInit(){AOS.init({duration:1e3,easing:"ease-in-out",once:!1,mirror:!1})}document.querySelector(".datepicker")&&flatpickr(".datepicker",{mode:"range",locale:"es"});